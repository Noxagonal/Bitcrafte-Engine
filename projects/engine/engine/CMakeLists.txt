
# Engine

cmake_minimum_required(VERSION 3.22)

get_auto_target_name(THIS_TARGET_NAME)


if(BITCRAFTE_BUILD_SHARED_ENGINE)
	set(ENGINE_OUTPUT_TYPE SHARED_LIBRARY)
else()
	set(ENGINE_OUTPUT_TYPE STATIC_LIBRARY)
endif()


# Set RHI component dependencies
set(BITCRAFTE_ENGINE_RHI_COMPONENT_DEPENDENCIES)
if(BITCRAFTE_BUILD_RHI_VULKAN)
	list(APPEND BITCRAFTE_ENGINE_RHI_COMPONENT_DEPENDENCIES rhi_vulkan)
endif()
if(BITCRAFTE_BUILD_RHI_METAL)
	list(APPEND BITCRAFTE_ENGINE_RHI_COMPONENT_DEPENDENCIES rhi_metal)
endif()


# Set window component dependencies
set(BITCRAFTE_ENGINE_WINDOW_COMPONENT_DEPENDENCIES)
if(BITCRAFTE_BUILD_WINDOW_WIN32)
	list(APPEND BITCRAFTE_ENGINE_WINDOW_COMPONENT_DEPENDENCIES window_manager_win32)
endif()
if(BITCRAFTE_BUILD_WINDOW_WAYLAND)
	list(APPEND BITCRAFTE_ENGINE_WINDOW_COMPONENT_DEPENDENCIES window_manager_wayland)
endif()


# Make the engine target
add_engine_component(${THIS_TARGET_NAME}
	${ENGINE_OUTPUT_TYPE}
	PUBLIC_LIBRARY_DEPENDENCIES
		core
		rhi
		window_manager
	PRIVATE_LIBRARY_DEPENDENCIES
		${BITCRAFTE_ENGINE_RHI_COMPONENT_DEPENDENCIES}
		${BITCRAFTE_ENGINE_WINDOW_COMPONENT_DEPENDENCIES}
)


# Set compile definitions for RHI components.
if(BITCRAFTE_BUILD_RHI_VULKAN)
	target_compile_definitions(${THIS_TARGET_NAME}
		PRIVATE
			BITCRAFTE_RHI_VULKAN=1
	)
endif()
if(BITCRAFTE_BUILD_RHI_METAL)
	target_compile_definitions(${THIS_TARGET_NAME}
		PRIVATE
			BITCRAFTE_RHI_METAL=1
	)
endif()


# Set compile definitions for window components.
if(BITCRAFTE_BUILD_WINDOW_WIN32)
	target_compile_definitions(${THIS_TARGET_NAME}
		PRIVATE
			BITCRAFTE_WINDOW_WIN32=1
	)
endif()
if(BITCRAFTE_BUILD_WINDOW_WAYLAND)
	target_compile_definitions(${THIS_TARGET_NAME}
		PRIVATE
			BITCRAFTE_WINDOW_WAYLAND=1
	)
endif()
